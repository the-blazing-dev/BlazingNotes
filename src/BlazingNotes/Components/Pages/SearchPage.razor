@page "/search"
@inject IState<AppState> AppState

<PageTitle>Search</PageTitle>

<MudStack Spacing="6">
    <MudTextField @bind-Value="_search"
                  Variant="Variant.Outlined"
                  AutoFocus
                  Label="Search"
                  Immediate/>

    @{
        var searchCleared = _search.Trim();
        if (searchCleared.Length >= 3)
        {
            var matches = AppState.Value.Notes.Where(x => x.Text.ContainsIgnoreCase(searchCleared))
                .ToList();
            var nonArchiveMatches = matches.Where(x => x.ArchivedAt == null).ToList();
            var archiveMatches = matches.Where(x => x.ArchivedAt.HasValue).ToList();

            <NoteCardList Notes="nonArchiveMatches"
                          Headline="Suchergebnisse"
                          SearchText="@searchCleared"/>

            @if (archiveMatches.HasContent())
            {
                <NoteCardList Notes="archiveMatches"
                              Headline="Archiviert"
                              SearchText="@searchCleared"
                              InitiallyExpanded="false"/>
            }
        }
        else
        {
            <NoteCardList Notes="[]"
                          Headline="Suchergebnisse"
                          NoNotesText="Bitte einen Suchbegriff mit mindestens 3 Zeichen eingeben"/>
        }
    }
</MudStack>

@code {

    string _search = "";

}